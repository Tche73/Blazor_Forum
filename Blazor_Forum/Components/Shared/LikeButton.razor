@using Blazor_Forum.Models
@using Blazor_Forum.Services
@inject IForumService ForumService

<button class="btn btn-sm @(isLiked ? "btn-success" : "btn-outline-success")" @onclick="ToggleLike">
    <i class="oi oi-thumb-up"></i> @likeCount
</button>

@code {
    [Parameter]
    public int ReponseId { get; set; }

    [Parameter]
    public int UserId { get; set; }

    [Parameter]
    public int Likes { get; set; }

    private bool isLiked = false;
    private int likeCount;
    private Like userLike;

    protected override void OnInitialized()
    {
        likeCount = Likes;
    }

    private async Task ToggleLike()
    {
        if (!isLiked)
        {
            // Ajouter un like
            var like = new Like
                {
                    ReponseId = ReponseId,
                    UserId = UserId
                };

            var result = await ForumService.AddLikeAsync(like);
            if (result != null)
            {
                userLike = result;
                isLiked = true;
                likeCount++;
            }
        }
        else if (userLike != null)
        {
            // Supprimer le like
            await ForumService.RemoveLikeAsync(userLike.Id);
            isLiked = false;
            likeCount--;
            userLike = null;
        }
    }
}